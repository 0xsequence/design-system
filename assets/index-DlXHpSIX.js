import{j as E}from"./jsx-runtime-D_zvdyIk.js";import{r as t}from"./index-CFahbR6w.js";import{M as S,u as L,P as W,a as b,b as A,L as D}from"./proxy-CM0HYg4P.js";class H extends t.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const s=e.offsetParent,d=s instanceof HTMLElement&&s.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=d-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function K({children:f,isPresent:l,anchorX:e}){const s=t.useId(),d=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=t.useContext(S);return t.useInsertionEffect(()=>{const{width:x,height:r,top:m,left:i,right:u}=n.current;if(l||!d.current||!x||!r)return;const h=e==="left"?`left: ${i}`:`right: ${u}`;d.current.dataset.motionPopId=s;const c=document.createElement("style");return p&&(c.nonce=p),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${r}px !important;
            ${h}px !important;
            top: ${m}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[l]),E.jsx(H,{isPresent:l,childRef:d,sizeRef:n,children:t.cloneElement(f,{ref:d})})}const U=({children:f,initial:l,isPresent:e,onExitComplete:s,custom:d,presenceAffectsLayout:n,mode:p,anchorX:x})=>{const r=L(B),m=t.useId();let i=!0,u=t.useMemo(()=>(i=!1,{id:m,initial:l,isPresent:e,custom:d,onExitComplete:h=>{r.set(h,!0);for(const c of r.values())if(!c)return;s&&s()},register:h=>(r.set(h,!1),()=>r.delete(h))}),[e,r,s]);return n&&i&&(u={...u}),t.useMemo(()=>{r.forEach((h,c)=>r.set(c,!1))},[e]),t.useEffect(()=>{!e&&!r.size&&s&&s()},[e]),p==="popLayout"&&(f=E.jsx(K,{isPresent:e,anchorX:x,children:f})),E.jsx(W.Provider,{value:u,children:f})};function B(){return new Map}const P=f=>f.key||"";function v(f){const l=[];return t.Children.forEach(f,e=>{t.isValidElement(e)&&l.push(e)}),l}const V=({children:f,custom:l,initial:e=!0,onExitComplete:s,presenceAffectsLayout:d=!0,mode:n="sync",propagate:p=!1,anchorX:x="left"})=>{const[r,m]=b(p),i=t.useMemo(()=>v(f),[f]),u=p&&!r?[]:i.map(P),h=t.useRef(!0),c=t.useRef(i),g=L(()=>new Map),[z,I]=t.useState(i),[C,j]=t.useState(i);A(()=>{h.current=!1,c.current=i;for(let a=0;a<C.length;a++){const o=P(C[a]);u.includes(o)?g.delete(o):g.get(o)!==!0&&g.set(o,!1)}},[C,u.length,u.join("-")]);const R=[];if(i!==z){let a=[...i];for(let o=0;o<C.length;o++){const y=C[o],w=P(y);u.includes(w)||(a.splice(o,0,y),R.push(y))}return n==="wait"&&R.length&&(a=R),j(v(a)),I(i),null}const{forceRender:M}=t.useContext(D);return E.jsx(E.Fragment,{children:C.map(a=>{const o=P(a),y=p&&!r?!1:i===C||u.includes(o),w=()=>{if(g.has(o))g.set(o,!0);else return;let $=!0;g.forEach(k=>{k||($=!1)}),$&&(M==null||M(),j(c.current),p&&(m==null||m()),s&&s())};return E.jsx(U,{isPresent:y,initial:!h.current||e?void 0:!1,custom:l,presenceAffectsLayout:d,mode:n,onExitComplete:y?void 0:w,anchorX:x,children:a},o)})})};export{V as A};
